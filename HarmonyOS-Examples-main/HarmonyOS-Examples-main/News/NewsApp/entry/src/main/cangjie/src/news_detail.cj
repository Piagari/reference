/**
 * Created on 2025/1/7
 */
package ohos_app_cangjie_entry

import ohos.base.*
import ohos.component.*
import ohos.state_manage.*
import ohos.state_macro_manage.*
import std.collection.*
import ohos.net.http.*
import ohos.prompt_action.*
import serialization.serialization.*
import encoding.json.*
import std.convert.*
import ohos.router.*


@Entry
@Component
class NewsDetailView {
    @State var imageIp: String = "http://192.168.3.11:8000"

    // ‰º†ÂÖ•ÂèÇÊï∞ÔºöÊñ∞ÈóªID
    let newsId : Int64 = Int64.tryParse(Router.getParams() ?? "") ?? 0

    // Êñ∞ÈóªÂØπË±°
    @State var news : News = News()
    @State var strLike : String = ""


    // ÊòæÁ§∫ÁïåÈù¢Êó∂Êõ¥Êñ∞Êñ∞Èóª
    protected override func onPageShow() {
        NewsManager.getInstance().queryNews(newsId) { res =>
            if (res) {
                news = NewsManager.getInstance().newsSearchLists[0]

                strLike = "ü©∑ ${news.propLikeNum}"
            }
        }
    }

    func build() {
        if(news.propId != 0){
            Column() {
                Text("Êñ∞ÈóªËØ¶ÊÉÖ")
                    .textAlign(TextAlign.Center)
                    .fontSize(16)
                    .fontColor(0xffffff)
                    .backgroundColor(0xffbb86fc)
                    .borderRadius(2)
                    .margin(top:2,bottom:2)
                    .width(98.percent)
                    .height(40)
                Text("${news.propTitle}")
                    .textAlign(TextAlign.Center)
                    .fontSize(14)
                    .maxLines(2)
                    .textOverflow(TextOverflow.None)
                    .borderRadius(2)
                    .margin(top:2,bottom:2)
                    .width(98.percent)
                    .height(40)
                Text("${news.propPublishDate}")
                    .textAlign(TextAlign.Center)
                    .fontSize(12)
                    .fontColor(0xdddddd)
                    .margin(top:2,bottom:2)
                    .width(98.percent)
                    .height(20)
                Image(imageIp + "${news.propCover}")
                    .objectFit(ImageFit.Fill)
                    .width(98.percent)
                    .height(30.percent)
                    .borderStyle(BorderStyle.Solid)
                    .borderRadius(10)
                Text("${news.propContent}")
                    .textAlign(TextAlign.Start)
                    .fontSize(14)
                    .borderRadius(2)
                    .margin(top:2,bottom:2)
                    .width(98.percent)

                Row(){
                    Text("üëâ ÂàÜ‰∫´" )
                        .width(25.percent)
                        .height(25)
                        .fontSize(12)
                        .fontColor(0xaaaaaa)
                        .textAlign(TextAlign.Center)
                        .onClick({  evt =>
                                      PromptAction.showToast(message:"Â∑≤Â§çÂà∂ÂÜÖÂÆπÔºåÂèØÁ≤òË¥¥ÂàÜ‰∫´")
                                })

                    Text("üí¨ 0" )
                        .width(25.percent)
                        .height(25)
                        .fontSize(12)
                        .fontColor(0xaaaaaa)
                        .textAlign(TextAlign.Center)
                        .onClick({  evt =>
                                      PromptAction.showToast(message:"ÊúüÂæÖ‰Ω†Êù•ÂºÄÂèëÊñ∞ÈóªËØÑËÆ∫Âì¶")
                                })
                    Text(strLike)
                        .width(25.percent)
                        .height(25)
                        .fontSize(12)
                        .fontColor(0xaaaaaa)
                        .textAlign(TextAlign.Center)
                        .onClick({  evt =>
                                    news.propLikeNum++
                                    strLike = "ü©∑ ${news.propLikeNum}"
                                    NewsManager.getInstance().modifyNews(news) { res =>
                                    }
                            })
                    Text("üåü Êî∂Ëóè")
                        .width(25.percent)
                        .height(25)
                        .fontSize(12)
                        .fontColor(0xaaaaaa)
                        .textAlign(TextAlign.Center)
                        .onClick({  evt =>
                             PromptAction.showToast(message: "Â∑≤Êî∂Ëóè!")
                        })
                }.height(40).margin(top:50)

            }.width(100.percent)
            .height(100.percent)
            .margin(top: 2)
        }
    }
}