/**
 * Created on 2024/8/26
 */
package ohos_app_cangjie_entry.component.card

import ohos.base.*
import ohos.component.*
import ohos.state_manage.*
import ohos.state_macro_manage.*
import std.sync.{Timer, sleep}
import std.time.{Duration}
import ohos_app_cangjie_entry.entity.*
import ohos_app_cangjie_entry.mock.VideoData

let TOP_BORDER_RADIUS = 6.fp

@Component
public class CoverCard {
    // 资源类型
    @Prop var mediaType: MediaType

    // 标题
    @Prop var title: String

    // 文本描述
    @Prop var desc: String

    @State var onPlaying: Bool = false

    let videoController = 

    func cardOnTouch(e: TouchEvent) {
        if (let MediaType.VIDEO(_) <- this.mediaType) {
            if (let TouchType.Up <- e.eventType) {
                this.stopVideo()
            } else if(let TouchType.Down <- e.eventType) {
                this.playVideo()
            }
        }
    }

    func playVideo() {
        this.onPlaying = true
        this.videoController.start()
    }

    func stopVideo() {
        this.onPlaying = false
        this.videoController.stop()
    }

    func build() {
        Column(10) {
            if(let IMAGE(src) <- mediaType) {
                Image(src).width(100.percent)
                .borderRadius(topLeft: TOP_BORDER_RADIUS, topRight: TOP_BORDER_RADIUS)
                .objectFit(ImageFit.Cover)
            } else if (let VIDEO(src) <- mediaType) {
                if (this.onPlaying) {
                    Video(src: src[1], controller: videoController)
                    .objectFit(ImageFit.Fill).height(150)
                    .loop(true)
                    .controls(false)
                } else {
                    Image(src[0]).width(100.percent)
                    .borderRadius(topLeft: TOP_BORDER_RADIUS, topRight: TOP_BORDER_RADIUS)
                    .objectFit(ImageFit.Fill).height(150)
                }
            }

            Column(10) {
                Text(title).fontSize(14).width(100.percent)

                Text(desc).fontSize(12).width(100.percent)
            }.padding(left: 10, right: 10, bottom: 10)
        }.width(100.percent)
        .alignItems(HorizontalAlign.Start)
        .borderRadius(TOP_BORDER_RADIUS)
        .backgroundColor(0xffffff)
        .onTouch(cardOnTouch)
    }
}